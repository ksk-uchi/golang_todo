# レビュー

## 指摘事項

- [Do] `backend/dto/auth.go` にリクエストとレスポンスの dto が定義されていますが、リクエストやレスポンスを意識するのは handler のみで、それ以外はリクエストやレスポンスという概念を意識したくないです。なのでこれらの定義は dto ではなく validators に実装して下さい。 (また `validate` タグをつけていますが、 validator を使用し忘れているようです。こちらも修正しておいてください)
  - `services.AuthService.Login` は `email, password` が必要なのでこのセットは `dto` に定義してください。今回の実装では `validators` に定義するリクエストの構造体と重複してしまいますが、あくまでリクエストの構造体を意識するのはハンドラのみで、必要な最小限の構造体を `dto` として意識するようにしてください。
- [Do] `backend/handlers/auth.go`, `backend/middleware/auth.go` の Cookie の設定で Expires を指定していますが、 JWT の有効期限があるのでこちらは不要だと思うので削除してください
- [Do] `backend/repositories/todo.go` の `UpdateTodo` では先に `todos.id` がコンテキストに紐づくユーザーのものか否かをチェックし、問題がなければ `todos.id` で更新する実装になっていますが、更新する部分でも `users.id` を含めるようにしてください。今後の開発で手が加わったときのことを考えるとその一行で得られるセキュアは大きいと思います。
- [Q(Done)] `backend/handlers/auth_test.go` の L.79 - L.81 で `mockService` の設定をしているようなのですが `MatchedBy` は何をしているのでしょうか？
  - `MockAuthService.Login` メソッドが呼び出された際の引数検証を行っています。
  - ハンドラ内でリクエストボディ (`reqBody`) をバインドして生成される `dto.LoginRequest` インスタンスは、ポインタアドレスがテストケース内で用意したものとは異なります。
  - そのため、単純なポインタ比較ではなく、`mock.MatchedBy` を使用して、引数として渡された構造体の中身 (`Email` と `Password`) が期待値と一致しているかを判定しています。
- [Do] `backend/handlers/todo_test.go` において `rec, req` を作る処理 (Cookie のセットも含む) は `http.Method, URL, user_id` を引数にする関数を定義しておけば多くのテストケースにおいてコードの重複を避けられると思うので、共通化してもらいたいです

## 作業ガイドライン

作業に当たり下記のガイドラインを必ず遵守してください

- Implementation Plan, Task, Walkthrough は日本語で出力してください
- **指摘事項に対応する場合は1点につき1コミット作成すること**
- 指摘事項が `[Q]` から始まるものがあれば、**すべての対応を行う前に**質問に回答すること
  - 回答が得られた `[Q]` は `[Q(Done)]` に変更します
    - `[Q(Done)]` は質問したことをログとして残すために使用します
    - `[Q(Done)]` から始まる指示は無視してください
  - 回答に応じて `[Do]` または `[Q]` から始まる指示を追記します
- 対応方法が複数考えられるものがある場合は、すべての対応を行う前に対応方法を説明し、どの方法を選択するか確認すること
  - その説明に応じて `[Do]` または `[Q]` から始まる指示を追記します
- `[Q]` から始まる指摘事項や対応方法が不明確な指摘事項がなくなったら対応を開始すること
- 指摘事項が `[Do]` から始まる場合は、指示に従い対応すること
